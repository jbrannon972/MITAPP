<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>One-Time Tool Uploader</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; text-align: center; height: 100vh; margin: 0; background-color: #f0f2f5; color: #333; }
        #container { padding: 30px; border-radius: 8px; font-size: 1.2em; max-width: 800px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background-color: #fff;}
        #status { padding: 20px; border-radius: 8px; margin-bottom: 15px; font-weight: 500; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .loading { background-color: #e2e3e5; color: #383d41; }
        #log { font-size: 0.8em; text-align: left; max-height: 400px; overflow-y: auto; background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 4px; margin-top: 15px;}
        #log div { padding: 4px; border-bottom: 1px solid #eee; }
        .log-info { color: #004085; }
        .log-success { color: #155724; font-weight: bold; }
        .log-skipped { color: #856404; }
    </style>
</head>
<body>

    <div id="container">
        <h1>Tool Inventory Initializer</h1>
        <p>This script will add the default list of tools to your Firestore database.</p>
        <div id="status" class="loading">Initializing...</div>
        <div id="log"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBEKOGT7S8rn3NKBNysT352GFGPt9GYf8E",
            authDomain: "mit-foreasting.firebaseapp.com",
            projectId: "mit-foreasting",
            storageBucket: "mit-foreasting.firebasestorage.app",
            messagingSenderId: "1069061948061",
            appId: "1:1069061948061:web:c657b4dfb344cb7b924a74",
            measurementId: "G-Z9ZE012Y2C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');

        function log(message, className = '') {
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            if (className) entry.className = className;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function uploadTools() {
            log('Script started.', 'log-info');
            statusDiv.textContent = 'Fetching existing tools...';

            const toolsToAdd = [
                'Hackzall', 'Socket sets', 'Mop heads', 'Heavy duty gloves', 'Suction cups',
                'Hand spray bottles', 'Safety glasses', 'Mop poles', 'Containment poles/ non-skid plates',
                'Staple guns', 'Hammers', 'Crowbars', 'Chalk lines', 'Trim puller', 'Cat claws',
                'Wire brushes', '5 in one', 'Vice grips', 'Dual sided screw drivers', 'Wire cutters',
                'Tape measures', 'Adjustable wrench', 'Levels', 'Channel locks', 'Ladder bucket',
                'Cones', '1 gallon sprayer bottle', 'Tool bags', 'Knee pads', 'Drywall hand saw',
                'Broom', 'Dust pans', 'Mop buckets', 'Vacuum', 'Vacuum attachments', 'Circular saw',
                'Power tool batteries', 'Chalk powder', 'Hex key set', 'Folding utility knife',
                'Voltage detectors', 'Floor scraper blades', 'Drilling bits set', 'Red crayon',
                'Pencils', 'Blade boxes', 'Lock boxes', 'Wood/metal saw blades', 'Scrapper saw attachment',
                '6 ft ladders', 'Step ladders'
            ];

            try {
                // 1. Get all existing tools to avoid duplicates
                const existingToolsSnapshot = await db.collection('hou_tools').get();
                const existingToolNames = new Set(existingToolsSnapshot.docs.map(doc => doc.data().name.toLowerCase()));
                log(`Found ${existingToolNames.size} existing tools in the database.`, 'log-info');

                // 2. Prepare a batch write for only the new tools
                const batch = db.batch();
                let newToolsCount = 0;

                toolsToAdd.forEach(toolName => {
                    if (existingToolNames.has(toolName.toLowerCase())) {
                        log(`Skipping "${toolName}" - already exists.`, 'log-skipped');
                    } else {
                        const newToolRef = db.collection('hou_tools').doc();
                        batch.set(newToolRef, {
                            name: toolName,
                            cost: 0
                        });
                        newToolsCount++;
                        log(`Adding "${toolName}" to the batch.`, 'log-info');
                    }
                });

                // 3. Commit the batch if there are new tools to add
                if (newToolsCount > 0) {
                    statusDiv.textContent = `Adding ${newToolsCount} new tools...`;
                    await batch.commit();
                    log(`Successfully committed ${newToolsCount} new tools to the database.`, 'log-success');
                } else {
                    log('No new tools to add.', 'log-info');
                }

                statusDiv.textContent = `âœ… Process Complete! Added ${newToolsCount} new tools. You can now close this page.`;
                statusDiv.className = 'success';

            } catch (error) {
                statusDiv.textContent = `Error: ${error.message}`;
                statusDiv.className = 'error';
                console.error(error);
                log(`ERROR: ${error.message}`, 'error');
            }
        }

        // Run the script automatically on page load
        uploadTools();
    </script>
</body>
</html>